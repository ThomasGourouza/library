<div class="container mt-5">
  <div class="settings">
    <div>
      <button class="btn btn-primary" (click)="resetForm()">
        Reset filters
      </button>
    </div>
    <div>
      <button
        type="button"
        class="btn btn-secondary"
        data-bs-toggle="modal"
        data-bs-target="#settingsModal"
      >
        Table settings
      </button>
    </div>
  </div>
  <div class="rounded overflow-hidden border">
    <form [formGroup]="filterForm">
      <table
        class="table table-bordered table-striped mb-0"
        style="table-layout: fixed"
      >
        <thead class="header">
          <tr>
            <th *ngFor="let header of headers | visible | order">
              <div class="flex">
                <div></div>
                <div class="header-label">{{ header.label }}</div>
                <div class="sort-icon">
                  <img
                    ngOptimizedImage
                    [src]="header.sortDirection | iconSrc"
                    (click)="onSort(header.name, header.sortDirection)"
                  />
                </div>
              </div>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td *ngFor="let header of headers | visible | order">
              <div class="flex">
                <input
                  [type]="header.hasMinMax ? 'number' : 'text'"
                  class="form-control"
                  [formControlName]="header.name"
                  placeholder="search..."
                />
                @if (header.hasMinMax) {
                <input
                  type="number"
                  class="form-control"
                  [formControlName]="header.name + min"
                  placeholder="min"
                />
                <input
                  type="number"
                  class="form-control"
                  [formControlName]="header.name + max"
                  placeholder="max"
                />
                }
              </div>
            </td>
          </tr>
          <tr
            *ngFor="
              let row of data
                | filter : filterParams()
                | sort : sortParams()
                | paginate : currentPage()! : pageLimit()!
            "
            (click)="onRowClick(rowId(), row[id])"
            [class.content]="true"
            [class.table-row-clickable]="row[id] !== rowId()"
            [class.selected]="row[id] === rowId()"
          >
            <td *ngFor="let header of headers | visible | order">
              {{ row[header.name] }}
            </td>
          </tr>
        </tbody>
      </table>
    </form>
  </div>

  <app-paginator
    [currentPage]="currentPage()!"
    [dataLength]="(data | filter : filterParams()).length"
    [pageLimit]="pageLimit()!"
  ></app-paginator>
</div>

<app-table-settings
  [headers]="headers"
  (newHeaders)="onNewHeaders($event)"
></app-table-settings>
