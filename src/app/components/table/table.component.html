<div class="row">
  <div class="main-table">
    <div class="rounded overflow-hidden border">
      <form [formGroup]="filterForm">
        <table
          class="table table-bordered table-striped mb-0"
          style="table-layout: fixed"
        >
          <thead class="header">
            <tr>
              <th *ngFor="let header of headers | visible | order">
                <div class="flex" [title]="header.label">
                  <div
                    class="order-icon hide"
                    [class.edge-col]="header.rank === 1"
                  >
                    @if (header.rank !== 1) {
                    <img
                      ngOptimizedImage
                      src="assets/icons/arrow-left.svg"
                      (click)="onLeft(header.name)"
                    />
                    }
                  </div>
                  <div class="header-label">
                    <img
                      ngOptimizedImage
                      class="header-icon"
                      [src]="header.icon | headerIconSrc"
                    />
                    <div [class.adjust]="!header.sortDirection"></div>
                    <img
                      [class.hide]="!header.sortDirection"
                      [class.header-icon]="!!header.sortDirection"
                      ngOptimizedImage
                      [src]="header.sortDirection | sortIconSrc : header.type"
                      (click)="onSort(header.name, header.sortDirection)"
                    />
                    <div [class.adjust]="!header.sortDirection"></div>
                  </div>
                  <div
                    class="order-icon hide"
                    [class.edge-col]="header.rank === headers.length"
                  >
                    @if (header.rank !== headers.length) {
                    <img
                      ngOptimizedImage
                      src="assets/icons/arrow-right.svg"
                      (click)="onRight(header.name)"
                    />
                    }
                  </div>
                </div>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td *ngFor="let header of headers | visible | order">
                <div class="flex">
                  @if (hasSearch(header)) {
                  <input
                    type="text"
                    class="form-control"
                    [id]="header.name + '-search'"
                    [formControlName]="header.name"
                    placeholder="search..."
                  />
                  } @if (hasBetween(header)) {
                  <input
                    type="number"
                    class="form-control"
                    [formControlName]="header.name + min"
                    placeholder="min"
                  />
                  <input
                    type="number"
                    class="form-control"
                    [formControlName]="header.name + max"
                    placeholder="max"
                  />
                  } @if (hasSelect(header)) {
                  <select
                    class="form-select"
                    [value]="filterForm.get(header.name)!.value"
                    (change)="
                      onSelectChange($event, header.name, header.isSelectAdd)
                    "
                  >
                    <option
                      *ngFor="let option of 'data' | selectList : header.name"
                      [value]="option"
                    >
                      {{ option | display : header.name }}
                    </option>
                  </select>
                  }
                  <div class="minus-plus">
                    @if (hasSelect(header)) {
                    <div class="d-flex align-items-center pointer">
                      <img
                        ngOptimizedImage
                        src="assets/icons/dash-circle.svg"
                        onmouseover="this.src='assets/icons/dash-circle-fill.svg'"
                        onmouseout="this.src='assets/icons/dash-circle.svg'"
                        (click)="onReset(header.name)"
                      />
                    </div>
                    <div class="d-flex align-items-center plus-check">
                      <img
                        ngOptimizedImage
                        [src]="header.isSelectAdd | plusSrc"
                      />
                      <img
                        ngOptimizedImage
                        src="assets/icons/plus-circle-fill.svg"
                        class="plus-check-hover"
                        (click)="header.isSelectAdd = !header.isSelectAdd"
                      />
                    </div>
                    }
                    @if (hasSearch(header)) {
                    <div class="d-flex align-items-center pointer">
                      <img
                        ngOptimizedImage
                        src="assets/icons/dash-circle.svg"
                        onmouseover="this.src='assets/icons/dash-circle-fill.svg'"
                        onmouseout="this.src='assets/icons/dash-circle.svg'"
                        (click)="onReset(header.name)"
                      />
                    </div>
                    <div class="d-flex align-items-center pointer">
                      <img
                        ngOptimizedImage
                        src="assets/icons/plus-circle.svg"
                        onmouseover="this.src='assets/icons/plus-circle-fill.svg'"
                        onmouseout="this.src='assets/icons/plus-circle.svg'"
                        (click)="onAddSearch(header.name)"
                      />
                    </div>
                    }
                    @if (hasBetween(header)) {
                    <div class="d-flex align-items-center pointer">
                      <img
                        ngOptimizedImage
                        src="assets/icons/dash-circle.svg"
                        onmouseover="this.src='assets/icons/dash-circle-fill.svg'"
                        onmouseout="this.src='assets/icons/dash-circle.svg'"
                        (click)="onReset(header.name + min)"
                      />
                    </div>
                    <div class="d-flex align-items-center pointer">
                      <img
                        ngOptimizedImage
                        src="assets/icons/dash-circle.svg"
                        onmouseover="this.src='assets/icons/dash-circle-fill.svg'"
                        onmouseout="this.src='assets/icons/dash-circle.svg'"
                        (click)="onReset(header.name + max)"
                      />
                    </div>
                    }
                  </div>
                </div>
              </td>
            </tr>
            <tr
              *ngFor="
                let row of data
                  | filter : filterParams()
                  | sort : sortParams()
                  | paginate : currentPage() : rowsLimit()
              "
              (click)="onRowClick(rowId(), row.id)"
              [class.content]="true"
              [class.table-row-clickable]="row.id !== rowId()"
              [class.selected]="row.id === rowId()"
            >
              <td *ngFor="let header of headers | visible | order">
                {{ row[header.name] | display : header.name }}
              </td>
            </tr>
          </tbody>
        </table>
      </form>
    </div>
    <app-paginator
      [currentPage]="currentPage()!"
      [dataLength]="(data | filter : filterParams()).length"
      [rowsLimit]="rowsLimit()!"
    ></app-paginator>

    <app-table-settings
      [headers]="headers"
      (newHeaders)="onNewHeaders($event)"
    ></app-table-settings>
  </div>
  <div class="icons">
    <div class="visible-column-icon">
      <button
        type="button"
        data-bs-toggle="modal"
        data-bs-target="#settingsModal"
        aria-label="Open visibility settings"
      >
        <img
          ngOptimizedImage
          #eyeIcon
          class="eye-icon"
          src="assets/icons/eye.svg"
          width="24"
          height="24"
          alt=""
          (mouseover)="eyeIcon.src = 'assets/icons/eye-fill.svg'"
          (mouseout)="eyeIcon.src = 'assets/icons/eye.svg'"
          title="Open columns visibility settings"
        />
      </button>
    </div>
    <div class="reset-filters-icon">
      <img
        ngOptimizedImage
        #filterIcon
        class="filter-icon"
        src="assets/icons/dash-circle.svg"
        (mouseover)="filterIcon.src = 'assets/icons/dash-circle-fill.svg'"
        (mouseout)="filterIcon.src = 'assets/icons/dash-circle.svg'"
        (click)="resetForm()"
        title="Reset all filters"
      />
    </div>
  </div>
</div>
